_somafm_complete() 
{
    local cur_word prev_word type_list

    cur_word="${COMP_WORDS[COMP_CWORD]}"
    prev_word="${COMP_WORDS[COMP_CWORD-1]}"
    type_list=""

    case $prev_word in
    somafm)
        type_list="channels listen"
        ;;
    listen)
        type_list=$(curl -s -H 'Accept: application/json' http://somafm.com/channels.json | jq -r '.channels[] | .id' | xargs echo)
        ;;
    esac

    COMPREPLY=( $(compgen -W "${type_list}" -- ${cur_word}) )

    return 0
}

complete -F _somafm_complete somafm


